<p align="center">
  <img src="https://img.shields.io/badge/A4AD-Comment%20Service-E0234E?style=for-the-badge&logo=nestjs&logoColor=white" alt="A4AD Comment Service">
</p>

<p align="center">
  <img src="https://img.shields.io/badge/NestJS-10+-E0234E?style=flat-square&logo=nestjs&logoColor=white" alt="NestJS">
  <img src="https://img.shields.io/badge/TypeScript-5.0+-3178C6?style=flat-square&logo=typescript&logoColor=white" alt="TypeScript">
  <img src="https://img.shields.io/badge/MongoDB-7+-47A248?style=flat-square&logo=mongodb&logoColor=white" alt="MongoDB">
  <img src="https://img.shields.io/badge/RabbitMQ-3+-FF6600?style=flat-square&logo=rabbitmq&logoColor=white" alt="RabbitMQ">
  <img src="https://img.shields.io/badge/License-MIT-green?style=flat-square" alt="License">
</p>

---

## üìù –û–ø–∏—Å–∞–Ω–∏–µ

**Comment Service** —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—ã–º–∏ –æ–±—Å—É–∂–¥–µ–Ω–∏—è–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –¥–ª—è —Ñ–æ—Ä—É–º–∞ A4AD. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–µ—Ä–µ–≤—å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –ª–∞–π–∫–∏ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ RabbitMQ —Å–æ–±—ã—Ç–∏—è. –ü–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ MongoDB –¥–ª—è –≥–∏–±–∫–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

–°–µ—Ä–≤–∏—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ REST API, —Ç–∞–∫ –∏ RabbitMQ RPC –¥–ª—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏.

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üí¨ **–î—Ä–µ–≤–æ–≤–∏–¥–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏** ‚Äî –°–∏—Å—Ç–µ–º–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ —Å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –≥–ª—É–±–∏–Ω–æ–π
- üå≥ **–î–µ—Ä–µ–≤—å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤** ‚Äî –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- üëç **–õ–∞–π–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤** ‚Äî –°–∏—Å—Ç–µ–º–∞ –ª–∞–π–∫–æ–≤ —Å —Å—á—ë—Ç—á–∏–∫–∞–º–∏
- üóëÔ∏è **–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** ‚Äî –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–º–µ—á–∞—é—Ç—Å—è –∫–∞–∫ —É–¥–∞–ª—ë–Ω–Ω—ã–µ, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
- üìÑ **–ü–∞–≥–∏–Ω–∞—Ü–∏—è** ‚Äî –ö—É—Ä—Å–æ—Ä–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤–µ—Ç–æ–∫
- ‚ö° **–î–≤–æ–π–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è** ‚Äî REST API + RabbitMQ RPC
- üìö **Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –ø–æ –∞–¥—Ä–µ—Å—É `/api`
- üîÑ **–ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π** ‚Äî –°–æ–±—ã—Ç–∏—è RabbitMQ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **–§—Ä–µ–π–º–≤–æ—Ä–∫:** NestJS 10+
- **–Ø–∑—ã–∫:** TypeScript 5.0+
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** MongoDB 7+
- **ODM:** Mongoose / @nestjs/mongoose
- **–ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π:** RabbitMQ (@golevelup/nestjs-rabbitmq)
- **–ö—ç—à/Rate Limit:** Redis
- **–í–∞–ª–∏–¥–∞—Ü–∏—è:** class-validator + class-transformer
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** Swagger/OpenAPI
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** Jest + Supertest

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
flowchart LR
    Gateway["API Gateway"] --> Comment["Comment Service<br/>NestJS + TypeScript"]
    Comment --> MongoDB[("MongoDB<br/>–ö–æ–ª–ª–µ–∫—Ü–∏—è Comments")]
    Comment --> RabbitMQ[("RabbitMQ<br/>–°–æ–±—ã—Ç–∏—è –∏ RPC")]

    RabbitMQ -.->|"comment.created"| Notification["Notification Service"]
    RabbitMQ -.->|"comment.liked"| Notification
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 20+
- pnpm (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –∏–ª–∏ npm
- MongoDB 7+
- RabbitMQ 3+
- Docker & Docker Compose (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:**

   ```bash
   git clone https://github.com/A4AD-team/comment-service.git
   cd comment-service
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**

   ```bash
   pnpm install
   ```

3. **–ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**

   ```bash
   docker compose up -d
   ```

4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

   ```bash
   cp .env.example .env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Å–æ —Å–≤–æ–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
   ```

5. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞:**

   ```bash
   # –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
   pnpm start:dev

   # –ü—Ä–æ–¥–∞–∫—à–µ–Ω-—Å–±–æ—Ä–∫–∞
   pnpm build
   pnpm start:prod
   ```

–°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000`

---

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è          | –û–ø–∏—Å–∞–Ω–∏–µ                            | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é                       |
| ------------------- | ----------------------------------- | ------------------------------------------- |
| `NODE_ENV`          | –û–∫—Ä—É–∂–µ–Ω–∏–µ (development, production) | `development`                               |
| `PORT`              | –ü–æ—Ä—Ç HTTP-—Å–µ—Ä–≤–µ—Ä–∞                   | `3000`                                      |
| `MONGODB_URI`       | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MongoDB        | `mongodb://localhost:27017/comment-service` |
| `RABBITMQ_URI`      | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RabbitMQ       | `amqp://guest:guest@localhost:5672`         |
| `REDIS_HOST`        | –•–æ—Å—Ç Redis                          | `localhost`                                 |
| `REDIS_PORT`        | –ü–æ—Ä—Ç Redis                          | `6379`                                      |
| `RATE_LIMIT_MAX`    | –ú–∞–∫—Å. –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –æ–∫–Ω–æ              | `30`                                        |
| `RATE_LIMIT_WINDOW` | –û–∫–Ω–æ rate limiting (—Å–µ–∫—É–Ω–¥—ã)        | `60`                                        |
| `LOG_LEVEL`         | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è                 | `info`                                      |

---

## üì° API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### REST API

| –ú–µ—Ç–æ–¥    | –ü—É—Ç—å                           | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| -------- | ------------------------------ | ------------------------------------------ |
| `POST`   | `/comments`                    | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                  |
| `GET`    | `/comments`                    | –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (query: `?postId=xxx`) |
| `GET`    | `/comments/:commentId`         | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| `PATCH`  | `/comments/:commentId`         | –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| `DELETE` | `/comments/:commentId`         | –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è                |
| `POST`   | `/comments/:commentId/like`    | –õ–∞–π–∫–Ω—É—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                       |
| `DELETE` | `/comments/:commentId/like`    | –£–±—Ä–∞—Ç—å –ª–∞–π–∫                                |
| `POST`   | `/comments/:commentId/restore` | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                   |

### Query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ                          | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é  |
| -------- | --------------------------------- | ---------------------- |
| `postId` | –§–∏–ª—å—Ç—Ä –ø–æ ID –ø–æ—Å—Ç–∞                | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è —Å–ø–∏—Å–∫–∞ |
| `limit`  | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É          | `20`                   |
| `cursor` | –ö—É—Ä—Å–æ—Ä –ø–∞–≥–∏–Ω–∞—Ü–∏–∏                  | -                      |
| `sort`   | –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: `asc`, `desc` | `desc`                 |

### Swagger

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:3000/api`

---

## üêá RabbitMQ RPC

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç RPC —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏.

### Routing Keys

| Routing Key       | –û–ø–∏—Å–∞–Ω–∏–µ                     |
| ----------------- | ---------------------------- |
| `comment.create`  | –°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π          |
| `comment.getAll`  | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ |
| `comment.get`     | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π         |
| `comment.update`  | –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π         |
| `comment.delete`  | –£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π          |
| `comment.like`    | –õ–∞–π–∫–Ω—É—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π         |
| `comment.unlike`  | –£–±—Ä–∞—Ç—å –ª–∞–π–∫                  |
| `comment.restore` | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π     |

### –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

```json
{
  "requestId": "uuid",
  "timestamp": "2026-02-20T12:00:00Z",
  "postId": "uuid",
  "content": "–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è",
  "authorId": "uuid"
}
```

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

```json
{
  "success": true,
  "data": { ... },
  "error": { "code": "ERROR_CODE", "message": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ" },
  "requestId": "uuid"
}
```

### –ü—Ä–∏–º–µ—Ä RPC –≤—ã–∑–æ–≤–∞

```typescript
const response = await amqpConnection.request({
  exchange: 'comments',
  routingKey: 'comment.create',
  payload: {
    requestId: 'uuid',
    timestamp: new Date().toISOString(),
    postId: 'post-uuid',
    content: '–ü—Ä–∏–≤–µ—Ç –º–∏—Ä',
    authorId: 'user-uuid',
  },
  timeout: 10000,
});
```

---

## ü©∫ Health Checks

| –≠–Ω–¥–ø–æ–∏–Ω—Ç        | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| --------------- | ----- | ---------------------------------- |
| `/health`       | `GET` | –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–¥–æ—Ä–æ–≤—å—è              |
| `/health/live`  | `GET` | Liveness –ø—Ä–æ–±–∞                     |
| `/health/ready` | `GET` | Readiness –ø—Ä–æ–±–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ MongoDB) |
| `/api`          | `GET` | Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API           |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pnpm test

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pnpm test:cov

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
pnpm test:watch

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pnpm test comments

# –ó–∞–ø—É—Å–∫ e2e —Ç–µ—Å—Ç–æ–≤
pnpm test:e2e
```

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).

---

<p align="center">
  <strong>–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –∫–æ–º–∞–Ω–¥–æ–π A4AD</strong>
</p>
